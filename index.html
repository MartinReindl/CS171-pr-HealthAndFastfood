<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Fast Food and Health in the US</title>

    <!-- ADD Libraries-->
    <script src="libs/d3/d3.min.js" charset="utf-8"></script>
    <script src="libs/topojson/topojson.v1.min.js"></script>
    <script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
    <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
    <script src="libs/queue-master/queue.min.js"></script>
	<script src="http://d3js.org/colorbrewer.v1.min.js"></script>
    <script src="libs/d3-tip/index.js"></script>
    <script src="libs/bootstrap-theme/js/jquery.easing.min.js"></script>
    <script src="libs/bootstrap-theme/js/jquery.fittext.js"></script>
    <script src="libs/bootstrap-theme/js/creative.js"></script>

    <!--Stylesheets-->
    <link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="libs/bootstrap-theme/css/creative.css" >
    <link rel="stylesheet" type="text/css" href="libs/bootstrap-theme/css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="css/myStyle.css">
    <link rel="stylesheet" type="text/css"href="libs/bootstrap-theme/font-awesome/css/font-awesome.min.css">

    <!-- our vis classes-->
    <script src = "js/statevis.js"></script>
    <script src = "js/restaurantvis.js"></script>
    <script src = "js/healthvis.js"></script>
    <script src = "js/legendvis.js"></script>
    <script src = "js/scattervis.js"></script>
    <script src = "js/timevis.js"></script>
    <script src = "js/healthbubblevis.js"></script>


</head>

<body id="page-top">

    <!-- HOME PAGE --> 
    <header id="home">
        <div class="header-content">
            <div class="header-content-inner">
                <br>
                <h1>Health and Fast Food in the United States</h1>
                <p>Andre Souffrant & Martin Reindl - CS 171 Final Project</p>
                <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
                <a href="#obesity" class="btn btn-primary btn-xl page-scroll">Find Out More</a>
            </div>
        </div>
    </header>

    <!-- OBESITY VISUALIZATION --> 
    <section class="bg-primary" id="obesity">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 text-center">
                    <h2 class="section-heading">Obesity in the United States</h2> 
                    <p>The percentage of obese adults in the United States has been rising steadily over the last two decades</p>
                    <div class="row" id="timeVis">
                    </div>
                </div>
            </div>
        </div>
    </section>    

    <!-- FAST FOOD VISUALIZATION --> 
    <section class="bg-secondary" id="fastfood">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 text-center">
                    <h2 class="section-heading">Fast Food in the United States</h2> 
                    <p>The number of fast food restaurants in the United States has similarly risen to surprising levels</p>
                    <center><img src="../libs/bootstrap-theme/img/franchises.jpg" alt="franchise"></center>
                </div>
            </div>
        </div>
    </section>    

    <!-- HEALTH VISUALIZATION --> 
    <section class="bg-health">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 text-center">
                    <h2 class="section-heading">Health in the United States</h2>
                    <p>Science suggests that high fast food consumption is the cause of poor health outcomes in the United States</p>
                    <div class="row" id="healthBubbleVis"></div>
                    <p> This graph shows the percentage of the adult population with the respective diseases in 2013<br> (CD = Cardiovascular Disease)<p>
                    
                </div>
            </div>
        </div>
    </section>    

    <!-- MAIN VISUALIZATION --> 
    <section id="visualization">
        <div class="row">
            <div class="col-md-12">
                <h2 class="section-heading text-center">Fast Food Restaurants and Health by Geographic Location</h2> 


    <div class="row">
        <div class="col-md-3">
			<div class="col-md-1">
			</div>
			<div class="col-md-11">
				<h2>Fast Food & Health</h2>
				<font size="1">
					This is an interactive visualization that allows you to explore the 
					relationship between fast food restaurant locations and measures of
					health. Use the radio controls below to change the health measures displayed 
					on the map and scatterplot. 
                    <br> 
                    Each state in the map is colored based on the percentage 
					of adults diagnosed with the selected health measure. The dots correspond to individual restaurants.
					The scatterplot shows the relationship between number of restaurants  
					and the percentage of adults diagnosed with the selected health measure. 
					Each point in the scatterplot corresponds to a state. The line represents a linear 
					regression to show overall trends. Use the checkboxes below	to filter the restaurants to be displayed on the map and to be factored into the  
					number of restaurants per million in the scatterplot. Click on states to update the selections shown in the bar charts. 
				</font>
			</div>
		</div>
        <div class="col-md-5" id="stateVis">
        </div>
      	<div class='col-sm-4'> 
			<div class='row' id='restaurantVis'>
            	<center><h2>Fast Food Restaurants</h2></center>
        	</div>
			<br>
			<br>
			<br>
			<br>
        	<div class='row' id='legendVis'>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-3">
			<center><h2>Change Map and Scatterplot</h2></center>
			<div class="col-md-6">
				<b>Select Fast Food Chains</b><br>
				<input type="checkbox" name="fast_food" class="event"
				id="Starbucks_map" value="Starbucks" checked/> Starbucks<br>
				<input type="checkbox" name="fast_food" class="event"
				id="McDonalds_map" value="McDonalds" checked/> McDonald's<br>
				<input type="checkbox" name="fast_food" class="event"
				id="BurgerKing_map" value="BurgerKing" checked/>
				Burger King<br>
				<input type="checkbox" name="fast_food" class="event"
				id="DairyQueen_map" value="DQ" checked/> Dairy Queen<br>
			</div>
			<div class="col-md-6">
				<b>Select Health Measure:</b>
				<br>
				<input type="radio" name="health_measure" value="Obesity" checked> Obesity<br>
				<input type="radio" name="health_measure" 
					   value="Cardiovascular Disease"> Cardiovascular Disease<br>
				<input type="radio" name="health_measure" value="Diabetes"> Diabetes<br>
				<input type="radio" name="health_measure" value="Mental Health"> Mental Health<br>
				<br>
			</div>
		</div>
		<div class="col-md-5" id="scatterVis">
		</div>
		<div class='col-sm-4' id='healthVis'>
			<center><h2>Health</h2></center>
		</div>
	</div>

    <!-- VIDEO SECTION --> 
    <section class="bg-video">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 text-center">
                    <h2 class="section-heading">Project Screen-Cast</h2>
                    <p>Watch this video to see a walkthrough of our website</p>
                    <iframe width="600" height="430" src="https://www.youtube.com/embed/iTMWu7XD9Cg" frameborder="0" allowfullscreen></iframe>            
                </div>
            </div>
        </div>
    </section>    


    <!-- CONTACT SECTION --> 
    <section id="contact" class="bg-contact">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 text-center">
                    <h2 class="section-heading">Let's Get In Touch!</h2>
                    <hr class="primary">
                    <p>Have questions about our project? That's great! Shoot us an email and we will get back to you as soon as possible!</p>
                </div>
                <div class="col-lg-4 col-lg-offset-2 text-center">
                    <i class="fa fa-envelope-o fa-3x"></i>
                    <p><a href="mailto:adsouffr@college.harvard.edu">adsouffr@college.harvard.edu </a></p>
                </div>
                <div class="col-lg-4 text-center">
                    <i class="fa fa-envelope-o fa-3x"></i>
                    <p><a href="mailto:martinreindl@college.harvard.edu">martinreindl@college.harvard.edu</a></p>
                </div>
            </div>
        </div>
    </section>




    <script>
        $(function(){  // this function is executed when the page is loaded

            //==========================================
            //--- HERE IS WHERE ALL THE MAGIC STARTS --
            //==========================================


            // variables keeping global knowledge of the data
            var restaurantData = [];
            var mapData = {};
            var stateData = [];
            var timeData = []; 
			var health_measure_selection = "Obesity";
			//var health_measure_scatter = "Obesity";
            var selection1; 
            var selection2; 
            var selection_switch = true; 
			var restaurant_filter = ["Starbucks", "BurgerKing", "McDonalds", "DQ"]
			//var restaurant_filter_scatter = ["Starbucks", "BurgerKing", "McDonalds", "DQ"]
			var filtered_restaurantData = restaurantData;
			var filtered_stateData = stateData;


            //Create an eventHandler
            var MyEventHandler = new Object();

            // call this function after Data is loaded, reformatted and bound to the variables
            var initVis = function(){

                //Instantiate all Vis Objects here
                var state_vis = new StateVis(d3.select("#stateVis"), restaurantData, mapData, stateData, MyEventHandler);
                var restaurant_vis = new RestaurantVis(d3.select("#restaurantVis"), stateData, MyEventHandler);
                var health_vis = new HealthVis(d3.select("#healthVis"), stateData, MyEventHandler);
                var legend_vis = new LegendVis(d3.select("#legendVis"), stateData, MyEventHandler);
				var scatter_vis = new ScatterVis(d3.select("#scatterVis"), stateData, MyEventHandler, restaurant_filter, health_measure_selection);
                var time_vis = new TimeVis(d3.select("#timeVis"), timeData);
                var healthbubble_vis = new HealthBubbleVis(d3.select("#healthBubbleVis"), stateData);

				// helper function to see if an array contains a value
				function contains(array, value){
					for(var i in array){
						if(array[i] == value){
							return i;
						}
					}
					return -1;
				}

				// helper function to change restaurant filters when checkbox is checked
				function update_restaurant_filters(){
					d3.selectAll("input").each(function(d){
						if(d3.select(this).attr("type") == "checkbox" &&
						   d3.select(this).attr("name") == "fast_food" &&
						   d3.select(this).node().checked){
							var restaurant = d3.select(this).attr("value");
							if(contains(restaurant_filter, restaurant) >= 0){
								// do nothing
							}
							else{
								restaurant_filter.push(restaurant)
							}
						}
						else{
							if(d3.select(this).attr("name") == "fast_food"){
								var restaurant = d3.select(this).attr("value");
								var index = contains(restaurant_filter, restaurant)
								if(index >= 0){
									restaurant_filter.splice(index, 1)
								}
							}
						}
					})
				}
	
				function update_health_encoding(){
					d3.selectAll("input").each(function(d){
						if(d3.select(this).attr("type") == "radio" &&
							d3.select(this).attr("name") == "health_measure" &&
							d3.select(this).node().checked){
							health_measure_selection = d3.select(this).attr("value");
						}
					})
				}

				// function that filters the restaurant data
				function filter_restaurant_data(){
					function filter_by_restaurant(restaurant){
						if (contains(restaurant_filter, restaurant["Restaurant"]) >= 0){
							return true;
						}
						else {
							return false;
						}
					}
					filtered_restaurantData = restaurantData.filter(filter_by_restaurant)
				}

				// bind actions to filter buttons
				d3.selectAll("input").on("change", function(){
					if(this.name == "fast_food"){
						update_restaurant_filters();
					}
					if(this.name == "health_measure"){
						update_health_encoding();
					}

					filter_restaurant_data();
					state_vis.updateVis(filtered_restaurantData, health_measure_selection);	
					scatter_vis.wrangleData(restaurant_filter, health_measure_selection)
					scatter_vis.updateVis();
				})

                $(MyEventHandler).bind("selectionChanged", function(event, _selection){

                    // check if a new selection has been made
                    if (_selection !== "checkbox"){
                         // update selection
                        if (selection_switch === true){
                            // save new selection
                            selection1 = _selection;
                            // flip switch
                            selection_switch = false; 

                        } else {
                            // save new selection
                            selection2 = _selection
                            // flip switch 
                            selection_switch = true; 
                        }
                    }

                    // create supporting visualizations
                    restaurant_vis.onSelectionChange(selection1, selection2);
                    health_vis.onSelectionChange(selection1, selection2);
                    legend_vis.onSelectionChange(selection1, selection2);
                });



            }

            // call this function after both files are loaded -- error should be "null" if no error
            var dataLoaded = function (error, _restaurantData, _mapData, _stateData,_timeData) {

                if (!error) {

                    // save loaded data
                    restaurantData = _restaurantData;
                    mapData = _mapData; 
                    stateData = _stateData; 
                    timeData = _timeData;

                    // set initial selections
                    selection1 = stateData[22];
                    selection2 = stateData[44];

                    // parse floats and ints from csv string values
                    stateData.forEach(function (d){
                        for (var k in d){
                            
                            if (k === "restaurants" || k === "BurgerKing" || k === "McDonalds"
                                || k === "DairyQueen" || k === "Starbucks" || k === "id"){
                                d[k] = parseInt(d[k]);
                            }
                            else if (k !== "name" && k !== "code"){
                                d[k] = parseFloat(d[k]);
                            }
                        }
                    })

                    initVis();
                }
            }

            var startHere = function(){
                // load data
				queue()
                    .defer(d3.csv, 'data/restaurant_locations.csv') 
                    .defer(d3.json, 'data/us.json')
                    .defer(d3.csv, 'data/states.csv')
                    .defer(d3.csv, 'data/time_series.csv')
                    .await(dataLoaded);
            }
     
            startHere();

            // add event listeners for checkboxes
            d3.selectAll("input").on("click", function (){
                $(MyEventHandler).trigger("selectionChanged", "checkbox");
            });
        })
    </script>
</body>
</html>
