<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Fast Food and Health in the US</title>

    <!-- ADD Libraries-->
    <script src="libs/d3/d3.min.js" charset="utf-8"></script>
    <script src="libs/topojson/topojson.v1.min.js"></script>
    <script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
    <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
    <script src="libs/queue-master/queue.min.js"></script>
	<script src="http://d3js.org/colorbrewer.v1.min.js"></script>

    <!--Stylesheets-->
    <link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">

    <!-- Get some nice font-->
   <link rel="stylesheet" type="text/css" href="css/font.css">


    <!-- our vis classes-->
    <script src = "js/statevis.js"></script>
    <script src = "js/restaurantvis.js"></script>
    <!--<script src = "js/healthvis.js"></script> --> 

    <!--  our stylesheet-->
    <link rel="stylesheet" type="text/css" href="css/myStyle.css">

</head>
<body>

    <h1><center>Fast Food and Health in the United States</center></h1>
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-2">
             Restaurant Filter:<br>
            <input type="checkbox" id="Starbucks" value="S_perCapita" />
            <label for="Starbucks">Starbucks</label><br>
            <input type="checkbox" id="McDonalds" value="MD_perCapita" checked/>
            <label for="McDonalds">McDonald's</label><br>
            <input type="checkbox" id="BurgerKing" value="BK_perCapita" checked/>
            <label for="BurgerKing">Burger King</label><br>
            <input type="checkbox" id="DairyQueen" value="DQ_perCapita" checked/>
            <label for="DairyQueen">Dairy Queen</label>
        </div>
        <div class="col-md-7" id="stateVis">
        </div>
        <div class="col-md-2">
            <form action="">Health Measure to Display:<br>
                <input type="radio" name="health_measure" value="obesity" checked> Obesity<br>
                <input type="radio" name="health_measure" 
                       value="cardiovascular_disease"> Cardiovascular Disease<br>
                <input type="radio" name="health_measure" value="diabetes"> Diabetes<br>
                <input type="radio" name="health_measure" value="mental_health"> Mental Health<br>
            </form>
        </div>
    </div>
    <div class="row">
        <div class='col-sm-4' id='restaurantVis'></div>
        <div class='col-sm-4'></div>
        <div class='col-sm-4' id='healthVis'></div>
    </div>




    <script>
        $(function(){ 

            //==========================================
            //--- HERE IS WHERE ALL THE MAGIC STARTS --
            //==========================================


            // variables keeping global knowledge of the data
            var restaurantData = [];
            var mapData = {};
            var stateData = [];
			var restaurant_filter = "none"
			var health_measure_selection = "obesity"


            // call this function after Data is loaded, reformatted and bound to the variables
            var initVis = function(){

                //TODO: Create an eventHandler  --> DONE :)
                var MyEventHandler = new Object();

                //TODO: Instantiate all Vis Objects here
                var state_vis = new StateVis(d3.select("#stateVis"), restaurantData, mapData, stateData, MyEventHandler);
                var restaurant_vis = new RestaurantVis(d3.select("#restaurantVis"), restaurantData, mapData, stateData, MyEventHandler);
                //var health_vis = new HealthVis(d3.select("#healthVis"), restaurantData, healthData, MyEventHandler);

                $(MyEventHandler).bind("selectionChanged", function(event, _selection){
                    
                    restaurant_vis.onSelectionChange(_selection);
                    //health_vis.onSelectionChange(brushRange.startDate, brushRange.endDate);
                });

            }

            // call this function after both files are loaded -- error should be "null" if no error
            var dataLoaded = function (error, _restaurantData, _mapData, _stateData) {

                if (!error) {

                    // save loaded data
                    restaurantData = _restaurantData;
                    mapData = _mapData; 
                    stateData = _stateData; 

                    // parse floats and ints from csv string values
                    stateData.forEach(function (d){
                        for (var k in d){
                            
                            if (k === "restaurants" || k === "BurgerKing" || k === "McDonalds"
                                || k === "DairyQueen" || k === "Starbucks" || k === "id"){
                                d[k] = parseInt(d[k]);
                            }
                            else if (k !== "name" && k !== "code"){
                                d[k] = parseFloat(d[k]);
                            }
                        }
                    })

                    console.log(restaurantData);
                    console.log(mapData);
                    console.log(stateData);

                    initVis();
                }
            }

            var startHere = function(){
                // load data
				queue()
                    .defer(d3.csv, 'data/restaurant_locations.csv') 
                    .defer(d3.json, 'data/us.json')
                    .defer(d3.csv, 'data/states.csv')
                    .await(dataLoaded);

            }
            
            startHere();

        })
    </script>
</body>
</html>
